<h1>Stock Lookup</h1>

<form method="post">
  {% csrf_token %}
  <input type="text" name="ticker" placeholder="Enter stock ticker" required>
  <button type="submit">Search</button>
</form>

{% if error %}
  <p style="color: red;">{{ error }}</p>
{% endif %}

{% if stock_data %}
  <h2>{{ stock_data.ticker }}</h2>
  <ul>
    <li><strong>Current Price:</strong> ${{ stock_data.current }}</li>
    <li><strong>Open:</strong> ${{ stock_data.open }}</li>
    <li><strong>High:</strong> ${{ stock_data.high }}</li>
    <li><strong>Low:</strong> ${{ stock_data.low }}</li>
    <li><strong>Previous Close:</strong> ${{ stock_data.prev_close }}</li>
    <li><strong>Change:</strong> ${{ stock_data.change }} ({{ stock_data.percent_change }}%)</li>
  </ul>
{% endif %}

{% if chart_data %}
<h2>7-Day Price Chart</h2>
<canvas id="priceChart" width="600" height="300"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('priceChart').getContext('2d');
  const priceChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ chart_data.labels|safe }},
      datasets: [{
        label: '{{ stock_data.ticker }} Price',
        data: {{ chart_data.prices|safe }},
        borderWidth: 2,
        fill: false,
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: false
        }
      }
    }
  });
</script>
{% endif %}